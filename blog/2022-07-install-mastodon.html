<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="utf-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1">
    <title>yude.jp | Mastodon ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’é«˜é€Ÿã«ä½œæˆã™ã‚‹</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css"
        rel="stylesheet"
        crossorigin="anonymous">
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css"
        integrity="sha512-1sCRPdkRXhBV2PBLUdRb4tMg1w2YPf37qatUFeS7zlBy7jJI8Lf4VHwWfZZfpXtYSLy85pkm9GaYVYMfw5BC1A=="
        crossorigin="anonymous"
        referrerpolicy="no-referrer" />
    <link rel="alternate"
        type="application/rss+xml"
        title="yude.jp RSS"
        href="/feed.xml" />
    <link rel="shortcut icon"
        type="image/png"
        href="/assets/images/yudejp.png">
    <link rel="alternate"
        type="application/rss+xml"
        href="https://www.yude.jp/feed.xml">
    <link rel="me"
        href="https://mstdn.yude.jp/@yude" />
    <link rel="me"
        href="https://mstdn.maud.io/@yude" />
    <link rel="me"
        href="https://mstdn.jp/@yude" />
    <link rel="me"
        href="https://mast.moe/@yude" />
    <link rel="me"
        href="https://mstdn.blue/@yude" />
    <link rel="me"
        href="https://mstdn.club/@yude" />
    <link rel="me"
        href="https://pawoo.net/@yude" />
    <link rel="me"
        href="https://sanin.club/@yude" />
    <link rel="me"
        href="https://social.vivaldi.net/@yude" />

    <style>
        body {
            background-color: #f7fafc;
        }
        
        @keyframes mawaru {
            0% { transform: rotate(0deg) }
            100% { transform: rotate(360deg) }
        }
        
        @keyframes gatagata {
            0%   { transform:translate(0, 0); }
            25%  { transform:translate(0, 2px) rotate(5deg); }
            50%  { transform:translate(0, 0, 0); }
            75%  { transform:translate(0, -2px) rotate(-5deg); }
            100% { transform:translate(0, 0); }
        }
        
        .gatagata:hover {
            animation: gatagata 0.3s linear infinite;
        }
        
        .mawaru:hover {
            animation: mawaru 3s linear infinite;
        }

        .title {
            animation: title 2.5s linear;
            animation-iteration-count: infinite;
        }

        @keyframes title {
            0%,
            100% {
                color: rgb(0, 0, 255);
            }

            50% {
                color: rgb(255, 0, 255);
            }
        }

        html,
        html[data-theme="light"] {
            --light-text-color: hsl(0, 0%, 35%);
            --main-background-color: hsl(0, 5%, 95%);
            --main-text-color: hsl(0, 0%, 0%);
            --card-background-color: hsl(0, 5%, 95%);
        }

        html[data-theme="dark"] {
            --light-text-color: hsl(0, 0%, 60%);
            --main-background-color: hsl(0, 0%, 10%);
            --main-text-color: hsl(0, 10%, 80%);
            --card-background-color: #0C0C0C;
        }

        @media (prefers-color-scheme: dark) {
            html {
                content: "dark";
            }
        }

        body {
            color: var(--main-text-color);
            background-color: var(--main-background-color);
        }

        .card,
        .dropdown-menu {
            background-color: var(--card-background-color) !important;
        }

        .blockquote {
            text-shadow: 1px 1px 2px var(--light-text-color);
        }

        a,
        .dropdown-item,
        .dropdown-item-text {
            color: var(--main-text-color);
        }
    </style>

    
</head>

<body>
    <script>
        const theme = localStorage.getItem('theme');
        if (theme === "dark") {
            document.documentElement.setAttribute('data-theme', 'dark');
        }
    </script>

    <div class="container mt-5">
        <ul class="nav flex-column flex-md-row">
            <div class="container-fluid">
                <a class="navbar-brand"
                    href="#">
                    <img src="/assets/images/yudejp.png"
                        alt="yude.jp logo"
                        width="40"
                        height="40"
                        class="d-inline-block align-text-top gatagata">
                    <a class="text-decoration-none title fs-3 font-monospace"
                        href="/"
                        style="position: relative; top: 11px; left: 5px"
                        tabindex="-1"
                        aria-disabled="true">yude.jp</a>
                </a>
            </div>
            <li class="nav-item">
                <a class="nav-link"
                    href="/profile"><i
                        class="fa-solid fa-user"></i>
                    ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</a>
            </li>
            <li class="nav-item">
                <a class="nav-link"
                    href="/blog"><i class="fa-solid fa-blog"></i>
                    ãƒ–ãƒ­ã‚°</a>
            </li>
            <li class="nav-item">
                <a class="nav-link"
                    href="/1ch"><i class="fa-solid fa-comment"></i>
                    1ch</a>
            </li>
            <li class="nav-item">
                <a class="nav-link"
                    href="https://pjsekai.sega.jp/character/unite04/nene/index.html"><i class="fa-solid fa-heart"></i>
                    è‰è–™å¯§ã€…ã¡ã‚ƒã‚“</a>
            </li>
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle"
                    data-bs-toggle="dropdown"
                    href="#"
                    role="button"
                    aria-expanded="false"><i class="fa-solid fa-egg"></i> ãã®ä»–</a>
                <ul class="dropdown-menu">
                    <li><span class="dropdown-item-text">å¤–éƒ¨ãƒªãƒ³ã‚¯</span></li>
                    <li><a class="dropdown-item"
                            href="https://discord.gg/X6srY7X"><i class="fa-brands fa-discord"></i> Discord ã‚µãƒ¼ãƒãƒ¼</a></li>
                    <li><a class="dropdown-item"
                            href="https://github.com/yudejp"><i class="fa-brands fa-github"></i> GitHub Organization</a>
                    </li>
                    <li><a class="dropdown-item"
                            href="https://status.yude.jp"><i class="fa-solid fa-check"></i> ã‚µãƒ¼ãƒ“ã‚¹ã®ç¨¼åƒçŠ¶æ³</a>
                    </li>
                    <hr class="dropdown-divider">
                    <li><span class="dropdown-item-text">ä»–ã®ãƒšãƒ¼ã‚¸</span></li>
                    <li><a class="dropdown-item"
                        href="/server"><i
                            class="fa-solid fa-server"></i> ã‚µãƒ¼ãƒãƒ¼</a></li>
                    <li><a class="dropdown-item"
                            href="/services"><i
                                class="fa-solid fa-star"></i> ã‚µãƒ¼ãƒ“ã‚¹</a></li>
                    <li><a class="dropdown-item"
                            href="/apps"><i
                                class="fa-solid fa-bomb"></i> ã‚¢ãƒ—ãƒª</a></li>
                    <li><a class="dropdown-item"
                            href="/links"><i
                                class="fa-solid fa-link"></i> ãƒªãƒ³ã‚¯é›†</a></li>
                    <li><a class="dropdown-item"
                            href="/tos"><i
                                class="fa-solid fa-wand-sparkles"></i> yude.jp ã‚µãƒ¼ãƒ“ã‚¹åˆ©ç”¨è¦ç´„</a></li>
                    <li><a class="dropdown-item"
                            href="/hcunews"><i
                                class="fa-solid fa-newspaper"></i> @hcunews ã«ã¤ã„ã¦</a></li>
                    <hr class="dropdown-divider">
                    <li><span class="dropdown-item-text">yude.jp on ...</span></li>
                    <li><a class="dropdown-item"
                            href="http://yudejpwxp2cziclocqjfd55ucw2dh6ncswopluh7exwusjlfkvkwhwqd.onion/">ğŸ§… Tor</a>
                    </li>
                    <li><a class="dropdown-item"
                            href="http://yude.i2p/?i2paddresshelper=idabfrazqbh7upvo2f5hx3ajpqglrwny66qbvcoatfqoq64ifiaq.b32.i2p"><i
                                class="fa-solid fa-braille"></i> I2P</a>
                    </li>
                </ul>
            </li>
            <button type="button"
                class="btn btn-dark"
                onClick="modeSwitcher()"
                id="theme-toggle"></button>

        </ul>

        <nav aria-label="breadcrumb"
            class="breadcrumb-parent"
            style="--bs-breadcrumb-divider: url(&#34;data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8'%3E%3Cpath d='M2.5 0L1 1.5 3.5 4 1 6.5 2.5 8l4-4-4-4z' fill='%236c757d'/%3E%3C/svg%3E&#34;);">
            <ol class="breadcrumb">
                
                <li class="breadcrumb-item"><a href="/">ğŸ  ãƒ›ãƒ¼ãƒ </a></li>
                
                
                <li class="breadcrumb-item"><a
                        href="/blog/">ğŸ“• ãƒ–ãƒ­ã‚°</a>
                </li>
                
                
                
                <li class="breadcrumb-item active"
                    aria-current="page">Mastodon ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’é«˜é€Ÿã«ä½œæˆã™ã‚‹</li>
                
                
            </ol>
        </nav>
        <div style="min-height: 30rem">
            <article class="post h-entry"
    itemscope
    itemtype="http://schema.org/BlogPosting">

    <header class="post-header"
        style="text-align: center">
        <h1 class="post-title p-name"
            itemprop="name headline">Mastodon ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’é«˜é€Ÿã«ä½œæˆã™ã‚‹</h1>
        <p class="post-meta">
            <i class="fa-solid fa-tags"></i>
            
            <span class="badge rounded-pill bg-success">Mastodon</span>
            
            <span class="badge rounded-pill bg-success">ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆ</span>
            
            <span class="badge rounded-pill bg-success">ActivityPub</span>
            <i style="margin-left: 3px"
                class="fa-solid fa-calendar-days"></i>
            <time class="dt-published"
                datetime="2022-07-25T00:00:00+00:00"
                itemprop="datePublished">
                2022/7/25
            </time><i style="margin-left: 3px"
                class="fa-solid fa-clock"></i>
            

3 åˆ†ã§èª­ã‚ã¾ã™
</p>
    </header>

    <div class="post-content e-content"
        itemprop="articleBody">
        <h1 id="å…è²¬--æ³¨æ„-äº‹é …">å…è²¬ / æ³¨æ„ äº‹é …</h1>
<ul>
  <li>yude ã¯ã“ã®è¨˜äº‹ã®å†…å®¹ã‚’ã‚ãªãŸãŒå®Ÿè¡Œã—ãŸçµæœã®è²¬ä»»ã‚’ä¸€åˆ‡è² ã†ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚è‡ªå·±è²¬ä»»ã§è¡Œã£ã¦ãã ã•ã„ã€‚</li>
</ul>

<h1 id="å¿…è¦ãªã‚‚ã®">å¿…è¦ãªã‚‚ã®</h1>
<ul>
  <li>Cloudflare ã§ç®¡ç†ã•ã‚Œã¦ã„ã‚‹ç‹¬è‡ªãƒ‰ãƒ¡ã‚¤ãƒ³</li>
  <li>Docker, Docker Compose, cloudflared ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ãƒã‚·ãƒ³
    <ul>
      <li>cloudflared ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•ã«ã¤ã„ã¦ã¯ã€ã“ã®è¨˜äº‹ã®æœ€å¾Œã®æ–¹ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚</li>
    </ul>
  </li>
</ul>

<h1 id="æ‰‹é †">æ‰‹é †</h1>

<ul>
  <li>ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¸­ã«å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆã€è¨˜äº‹ã®ä¸‹ã®æ–¹ã«ã‚ã‚‹ã€Œãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã€ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚</li>
</ul>

<h2 id="1-ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®-git-ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ã—ã¾ã™">1. ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã® Git ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ã—ã¾ã™ã€‚</h2>
<ul>
  <li>yude ãŒä½œæˆã—ãŸäººã®ã¬ãã‚‚ã‚Šã®ã‚ã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ Git ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ã—ã¾ã™ã€‚
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$ </span>git clone https://github.com/yude/docker-mastodon mastodon
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="2-cloudflare-ã«-cloudflared-ã‹ã‚‰ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã™">2. Cloudflare ã« <code class="language-plaintext highlighter-rouge">cloudflared</code> ã‹ã‚‰ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã™ã€‚</h2>
<ul>
  <li>ã¾ãšã€ä¸å…·åˆã‚’é˜²ããŸã‚ã«äº‹å‰ã« Cloudflare ã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãŠãã¾ã™ã€‚</li>
  <li>ãã®å¾Œã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€Cloudflare ã®èªè¨¼ãƒšãƒ¼ã‚¸ã¸ã® URL ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
    <ul>
      <li>è‹¥å¹²å‡¦ç†ãŒé•·ã„ãŸã‚ã€æ°—é•·ã«å¾…ã£ã¦ãã ã•ã„ã€‚
        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$ </span>cloudflared login
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>Cloudflare ã®èªè¨¼ãƒšãƒ¼ã‚¸ã§ã¯ã€ã‚ãªãŸãŒ Mastodon ã‚’å…¬é–‹ã™ã‚‹äºˆå®šã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’æŒ‡å®šã—ã¦ãã ã•ã„ã€‚</li>
</ul>

<h2 id="3-cloudflare-ã®è¨­å®šã‚’è¡Œã„ã¾ã™">3. Cloudflare ã®è¨­å®šã‚’è¡Œã„ã¾ã™ã€‚</h2>
<ol>
  <li>ãƒˆãƒ³ãƒãƒ«ã‚’å®šç¾©ã—ã¾ã™ã€‚
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nv">$ </span>cloudflared tunnel create mastodon
</code></pre></div>    </div>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">mastodon</code> ã®éƒ¨åˆ†ã¯è‹±æ•°å­—ã§ä»»æ„ã«è¨­å®šã§ãã¾ã™ã€‚</li>
    </ul>
  </li>
  <li>ãƒ‰ãƒ¡ã‚¤ãƒ³ã¨ãƒˆãƒ³ãƒãƒ«ã‚’ç´ä»˜ã‘ã¾ã™ã€‚
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nv">$ </span>cloudflared tunnel route dns mastodon mstdn.yude.jp
</code></pre></div>    </div>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">mastodon</code> ã®éƒ¨åˆ†ã¯ã‚¹ãƒ†ãƒƒãƒ— 1 ã§å®šç¾©ã—ãŸãƒˆãƒ³ãƒãƒ«åã‚’æŒ‡å®šã—ã¦ãã ã•ã„ã€‚</li>
      <li><code class="language-plaintext highlighter-rouge">mstdn.yude.jp</code> ã®éƒ¨åˆ†ã¯ Mastodon ã‚’ç¨¼åƒã•ã›ã‚‹äºˆå®šã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’æŒ‡å®šã—ã¦ãã ã•ã„ã€‚</li>
    </ul>
  </li>
</ol>

<h2 id="4-docker-ã‚³ãƒ³ãƒ†ãƒŠã®è¨­å®šã‚’è¡Œã„ã¾ã™">4. Docker ã‚³ãƒ³ãƒ†ãƒŠã®è¨­å®šã‚’è¡Œã„ã¾ã™ã€‚</h2>
<p>ã‚¯ãƒ­ãƒ¼ãƒ³ã—ãŸãƒªãƒã‚¸ãƒˆãƒªå†…ã«ã‚ã‚‹ <code class="language-plaintext highlighter-rouge">docker-compose.yaml</code> ã‚’é–‹ãã€å¿…è¦ãªé …ç›®ã‚’è¨­å®šã—ã¦ã„ãã¾ã™ã€‚</p>

<ul>
  <li>ã‚µãƒ¼ãƒ“ã‚¹ <code class="language-plaintext highlighter-rouge">cloudflared</code> ã® <code class="language-plaintext highlighter-rouge">command</code> ã®é …ã«ã‚ã‚‹ <code class="language-plaintext highlighter-rouge">mastodon</code> ã®éƒ¨åˆ†ã‚’ã€ã‚¹ãƒ†ãƒƒãƒ— 4.1 ã§æŒ‡å®šã—ãŸãƒˆãƒ³ãƒãƒ«åã«å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚<br />
ä¾‹ã®ã¨ãŠã‚Šã« <code class="language-plaintext highlighter-rouge">mastodon</code> ã¨ã—ãŸå ´åˆã¯ã€ä½•ã‚‚ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</li>
</ul>

<h2 id="5-mastodon-ã®è¨­å®šã‚’è¡Œã„ã¾ã™">5. Mastodon ã®è¨­å®šã‚’è¡Œã„ã¾ã™ã€‚</h2>
<ol>
  <li>ã¾ãšã¯ã€è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nv">$ </span>wget <span class="nt">-O</span> .env.production https://raw.githubusercontent.com/mastodon/mastodon/main/.env.production.sample
</code></pre></div>    </div>
  </li>
  <li><code class="language-plaintext highlighter-rouge">.env.production</code> ã‚’é–‹ãã€å¿…è¦ãªé …ç›®ã‚’è¨­å®šã—ã¦ã„ãã¾ã™ã€‚
    <ul>
      <li>ã¾ãšã¯ã€è¨­å®šã«ä½¿ç”¨ã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ã‚’2ã¤ç¤ºã—ã¾ã™ã€‚ã“ã‚Œã‚‰ã¯ã€ä¸¡æ–¹ã¨ã‚‚ <code class="language-plaintext highlighter-rouge">docker-compose.yaml</code> ãŒå­˜åœ¨ã™ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚</li>
    </ul>
    <ul>
      <li>ã‚³ãƒãƒ³ãƒ‰1: <code class="language-plaintext highlighter-rouge">docker compose run --rm web bundle exec rake secret</code></li>
      <li>ã‚³ãƒãƒ³ãƒ‰2: <code class="language-plaintext highlighter-rouge">docker compose run --rm web bundle exec rake mastodon:webpush:generate_vapid_key</code></li>
    </ul>
  </li>
</ol>

<ul>
  <li>ä»¥ä¸‹ãŒ <code class="language-plaintext highlighter-rouge">.env.production</code> ä¸­ã®è¨­å®šé …ç›®ã§ã™ã€‚
    <ul>
      <li><code class="language-plaintext highlighter-rouge">S3_ENABLED</code>: <code class="language-plaintext highlighter-rouge">false</code> ã«è¨­å®šã—ã¾ã™ã€‚</li>
      <li><code class="language-plaintext highlighter-rouge">LOCAL_DOMAIN</code>: Mastodon ã‚’ç¨¼åƒã•ã›ã‚‹äºˆå®šã®ãƒ‰ãƒ¡ã‚¤ãƒ³ (ä¾‹: <code class="language-plaintext highlighter-rouge">mstdn.yude.jp</code>)</li>
      <li><code class="language-plaintext highlighter-rouge">REDIS_HOST</code>: <code class="language-plaintext highlighter-rouge">redis</code> ã«å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚</li>
      <li><code class="language-plaintext highlighter-rouge">DB_HOST</code>: <code class="language-plaintext highlighter-rouge">db</code> ã«å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚</li>
      <li><code class="language-plaintext highlighter-rouge">ES_ENABLED</code>: ä»Šå›ã¯ <code class="language-plaintext highlighter-rouge">false</code> ã«å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚</li>
      <li><code class="language-plaintext highlighter-rouge">SECRET_KEY_BASE</code>: <strong>ã‚³ãƒãƒ³ãƒ‰1</strong>ã‚’å®Ÿè¡Œã—ã¦å¾—ã‚‰ã‚ŒãŸæ–‡å­—åˆ—ã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚</li>
      <li><code class="language-plaintext highlighter-rouge">OTP_SECRET</code>: <strong>ã‚³ãƒãƒ³ãƒ‰1</strong>ã‚’å®Ÿè¡Œã—ã¦å¾—ã‚‰ã‚ŒãŸæ–‡å­—åˆ—ã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚ãŸã ã—ã€<code class="language-plaintext highlighter-rouge">SECRET_KEY_BASE</code> ã¨ã¯ç•°ãªã‚‹æ–‡å­—åˆ—ã«ãªã‚‹ã‚ˆã†ã«ã—ã¦ãã ã•ã„ã€‚(2å›ç”Ÿæˆã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚)</li>
      <li><code class="language-plaintext highlighter-rouge">VAPID_PRIVATE_KEY</code> &amp; <code class="language-plaintext highlighter-rouge">VAPID_PUBLIC_KEY</code>: <strong>ã‚³ãƒãƒ³ãƒ‰2</strong>ã‚’å®Ÿè¡Œã—ã¦å¾—ã‚‰ã‚ŒãŸæ–‡å­—åˆ—ã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ãã®ã¾ã¾è²¼ã‚Šä»˜ã‘ã‚‰ã‚Œã‚‹å½¢å¼ã§çµæœã‚’å¾—ã‚‰ã‚Œã¾ã™ã€‚</li>
    </ul>
    <hr />

    <ul>
      <li>
        <p>ä»¥ä¸‹ã®è¨­å®šé …ç›®ã«ã¯ã€SMTP ã‚µãƒ¼ãƒ (é›»å­ãƒ¡ãƒ¼ãƒ«ã®é€ä¿¡ã‚’æ‹…å½“ã™ã‚‹ã‚µãƒ¼ãƒ) ãŒå¿…è¦ã§ã™ã€‚ãªã‚“ã‚‰ã‹ã®æ‰‹æ®µã«ã‚ˆã£ã¦ã€ã“ã‚Œã‚’ç”¨æ„ã—ã¦ãã ã•ã„ã€‚</p>

        <ul>
          <li><code class="language-plaintext highlighter-rouge">SMTP_SERVER</code>: SMTP ã‚µãƒ¼ãƒã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æŒ‡å®šã—ã¦ãã ã•ã„ã€‚</li>
          <li><code class="language-plaintext highlighter-rouge">SMTP_PORT</code>: SMTP ã‚µãƒ¼ãƒã®ãƒãƒ¼ãƒˆç•ªå·ã‚’æŒ‡å®šã—ã¦ãã ã•ã„ã€‚</li>
          <li><code class="language-plaintext highlighter-rouge">SMTP_LOGIN</code>: SMTP ã‚µãƒ¼ãƒã®ãƒ¦ãƒ¼ã‚¶ ID ã‚’æŒ‡å®šã—ã¦ãã ã•ã„ã€‚</li>
          <li><code class="language-plaintext highlighter-rouge">SMTP_PASSWORD</code>: SMTP ã‚µãƒ¼ãƒã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’æŒ‡å®šã—ã¦ãã ã•ã„ã€‚</li>
          <li><code class="language-plaintext highlighter-rouge">SMTP_FROM_ADDRESS</code>: ã‚µãƒ¼ãƒãƒ¼ã®åˆ©ç”¨è€…ã‹ã‚‰ã€Mastodon ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‹ã‚‰ã®ãƒ¡ãƒ¼ãƒ«ã«ä»˜å±ã™ã‚‹ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ã©ã®ã‚ˆã†ã«è¦‹ã›ãŸã„ã‹ã‚’æŒ‡å®šã—ã¦ãã ã•ã„ã€‚(ä¾‹: <code class="language-plaintext highlighter-rouge">noreply@yude.jp</code>)</li>
        </ul>
      </li>
    </ul>

    <hr />

    <ul>
      <li>ã¾ãŸã€è‡ªåˆ†ã—ã‹ä½¿ç”¨ã—ãªã„å ´åˆã¯ã€<code class="language-plaintext highlighter-rouge">.env.production</code> ã«ä»¥ä¸‹ã‚’è¿½è¨˜ã—ã¦ãã ã•ã„ã€‚
        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  SINGLE_USER_MODE=true
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ul>

<ol>
  <li>ã‚¢ã‚»ãƒƒãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’åˆæœŸåŒ–ã—ã¾ã™ã€‚
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nv">$ </span>docker compose run <span class="nt">--rm</span> web rails db:migrate
 <span class="nv">$ </span>docker compose run <span class="nt">--rm</span> web rails assets:precompile
</code></pre></div>    </div>
  </li>
</ol>

<h2 id="6-èµ·å‹•ã—ã¾ã™">6. èµ·å‹•ã—ã¾ã™ã€‚</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ docker compose up -d
</code></pre></div></div>
<ul>
  <li>èµ·å‹•å¾Œã€ã‚ãªãŸã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ã§ãã‚‹ã ã‘æ—©ãä½œæˆã—ã¦ãã ã•ã„ã€‚</li>
  <li>èµ·å‹•ã—ãŸã‚‰ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ã‚ãªãŸã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ã‚ªãƒ¼ãƒŠãƒ¼ã«è¨­å®šã—ã¦ãã ã•ã„ã€‚
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> <span class="si">$(</span>docker compose ps <span class="nt">-q</span> web<span class="si">)</span> bin/tootctl accounts modify your_name <span class="nt">--role</span> Owner
</code></pre></div>    </div>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">your_name</code> ã«ã¯ã‚ãªãŸã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒãƒ¼ãƒ ã‚’æŒ‡å®šã—ã¾ã™ã€‚(ä¾‹: <code class="language-plaintext highlighter-rouge">@your_name</code> ã¨è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã‚’ã€<code class="language-plaintext highlighter-rouge">your_name</code> ã¨ã—ã¦æŒ‡å®šã—ã¾ã™ã€‚)</li>
    </ul>
  </li>
</ul>

<h1 id="å‚è€ƒ-cloudflared-ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹">å‚è€ƒ: cloudflared ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹</h1>
<ul>
  <li>Debian ã®å ´åˆ
    <ol>
      <li>ãƒªãƒã‚¸ãƒˆãƒªã‚’è¿½åŠ ã—ã¾ã™ã€‚
        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"deb [signed-by=/usr/share/keyrings/cloudflare-main.gpg] https://pkg.cloudflare.com/ buster main"</span> | <span class="nb">sudo tee</span> /etc/apt/sources.list.d/cloudflare-main.list 
</code></pre></div>        </div>
      </li>
      <li>å…¬é–‹éµã‚’è¿½åŠ ã—ã¾ã™ã€‚
        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nv">$ </span><span class="nb">sudo </span>curl https://pkg.cloudflare.com/cloudflare-main.gpg <span class="nt">-o</span> /usr/share/keyrings/cloudflare-main.gpg
</code></pre></div>        </div>
      </li>
      <li><code class="language-plaintext highlighter-rouge">cloudflared</code> ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚
        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nv">$ </span><span class="nb">sudo </span>apt update<span class="p">;</span> <span class="nb">sudo </span>apt <span class="nt">-y</span> <span class="nb">install </span>cloudflared
</code></pre></div>        </div>
      </li>
    </ol>
  </li>
  <li>ãã®ä»–ã®ãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã«ã¤ã„ã¦ã¯ã€<a href="https://pkg.cloudflare.com/">ã“ã¡ã‚‰</a> ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚</li>
</ul>

<h1 id="ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°">ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°</h1>

<ul>
  <li>Docker Compose ã«ã¤ã„ã¦:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">docker compose</code> ã‚’å®Ÿè¡Œã—ã¦ã€<code class="language-plaintext highlighter-rouge">'compose' is not a docker command.</code> ã¨è¡¨ç¤ºã•ã‚Œãªã„ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</li>
      <li>ã‚‚ã—ãã®ã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã¦ã—ã¾ã£ãŸå ´åˆã€<code class="language-plaintext highlighter-rouge">docker-compose</code> ã¨ã„ã†ã‚³ãƒãƒ³ãƒ‰ãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚
        <ul>
          <li>å­˜åœ¨ã—ãŸå ´åˆ
            <ul>
              <li>è¨˜äº‹ä¸­ã® <code class="language-plaintext highlighter-rouge">docker compose</code> ã®éƒ¨åˆ†ã‚’ <code class="language-plaintext highlighter-rouge">docker-compose</code> ã«èª­ã¿æ›¿ãˆã¦ãã ã•ã„ã€‚</li>
            </ul>
          </li>
          <li>å­˜åœ¨ã—ãªã„å ´åˆ
            <ul>
              <li>Docker ã®å…¬å¼ãƒªãƒã‚¸ãƒˆãƒªã‚’ä½¿ç”¨ã—ã¦ã€æœ€æ–°ã® Docker Engine ã¨ Docker Compose Plugin ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã ã•ã„ã€‚</li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">Error 1033: Argo Tunnel error</code> ãŒç™ºç”Ÿã™ã‚‹å ´åˆ
    <ul>
      <li><code class="language-plaintext highlighter-rouge">cloudflared</code> ã®å‹•ä½œã«ç•°å¸¸ãŒã‚ã‚Šã¾ã™ã€‚ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãƒ­ã‚°ã‚’è¡¨ç¤ºã™ã‚‹ã“ã¨ã§ã€å•é¡Œè§£æ±ºã®åŠ©ã‘ã¨ãªã‚‹ã§ã—ã‚‡ã†ã€‚
        <ul>
          <li><code class="language-plaintext highlighter-rouge">docker compose logs cloudflared</code></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">Internal Server Error</code> ãŒç™ºç”Ÿã™ã‚‹ã€‚
    <ul>
      <li>å¤šãã¯ãƒ•ã‚¡ã‚¤ãƒ«ã®æ¨©é™ãŒé–“é•ã£ã¦ã„ã‚‹ã“ã¨ãŒåŸå› ã§ã™ã€‚ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§æ¨©é™ã‚’ä¿®æ­£ã§ãã¾ã™ã€‚<br />
  <code class="language-plaintext highlighter-rouge">docker compose exec -u root web chown -R mastodon:mastodon ./</code></li>
    </ul>
  </li>
</ul>

    </div>

    <p><strong>åŒ¿åã§ã‚³ãƒ¡ãƒ³ãƒˆã§ãã¾ã™ã€‚</strong><br>ã€Œã¾ãŸã¯ Disqus ã«ç™»éŒ²ã€ã®ä¸‹ã«ã‚ã‚‹ã€Œåå‰ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‹ã‚‰ã€ã€Œã‚²ã‚¹ãƒˆã¨ã—ã¦æŠ•ç¨¿ã™ã‚‹ã€ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã¦ãã ã•ã„ã€‚</p>
    <div id="disqus_thread"></div>
    <script>
        /**
        *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
        /*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables    */

        var disqus_config = function () {
            this.page.url = "https://yude.jp/blog/2022-07-install-mastodon";  // Replace PAGE_URL with your page's canonical URL variable
            this.page.identifier = "/blog/install-mastodon"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
        };

        (function () { // DON'T EDIT BELOW THIS LINE
            var d = document, s = d.createElement('script');
            s.src = 'https://yudejp.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>

    <a class="u-url"
        href="/blog/2022-07-install-mastodon"
        hidden></a>
</article>
        </div>
        <hr>
        <div>
            <a href="https://sites.google.com/site/happybusy/"><img style="margin-left: auto; margin-right:auto"
                    src="/assets/images/busy_banner.png"></a>
        </div>
        <div class="mt-2">
            <img src="https://count.getloli.com/get/@yude?theme=asoul"
                alt="è¡¨ç¤ºã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ (count.getloli.com)"
                loading="lazy" />
        </div>
        <div class="mt-2">
            <p>
                ãƒªãƒ“ã‚¸ãƒ§ãƒ³:  (<a href="https://github.com/yudejp/yude.jp">ãƒªãƒã‚¸ãƒˆãƒª</a>)<br>
                <a href="https://jekyllrb-ja.github.io/">Jekyll</a>
                ã«ã‚ˆã£ã¦ãƒ“ãƒ«ãƒ‰ã•ã‚Œã€Cloudflare
                Pages ä¸Šã§ãƒ›ã‚¹ãƒˆã•ã‚Œã¦ã„ã¾ã™ã€‚<br>
                &copy; 2022 yude &lt;i[at]yude.jp&gt;. <a
                    href="https://github.com/yudejp/yude.jp/blob/main/README.md">è©³ç´°</a><br>
            </p>
        </div>

    </div>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.9.2/umd/popper.min.js"
        integrity="sha512-2rNj2KJ+D8s1ceNasTIex6z4HWyOnEYLVC3FigGOmyQCZc2eBXKgOxQmo3oKLHyfcj53uz4QMsRCWNbLd32Q1g=="
        crossorigin="anonymous"
        referrerpolicy="no-referrer"></script>
    

    

    
    <script>
        const userPrefers = getComputedStyle(document.documentElement).getPropertyValue('content');

        if (theme === "dark") {
            document.getElementById("theme-toggle").innerHTML = '<i class="fa-solid fa-sun"></i>';
        } else if (theme === "light") {
            document.getElementById("theme-toggle").innerHTML = '<i class="fa-solid fa-moon"></i>';
        } else if (userPrefers === "dark") {
            document.documentElement.setAttribute('data-theme', 'dark');
            window.localStorage.setItem('theme', 'dark');
            document.getElementById("theme-toggle").innerHTML = '<i class="fa-solid fa-sun"></i>';
        } else {
            document.documentElement.setAttribute('data-theme', 'light');
            window.localStorage.setItem('theme', 'light');
            document.getElementById("theme-toggle").innerHTML = '<i class="fa-solid fa-moon"></i>';
        }

        function modeSwitcher() {
            let currentMode = document.documentElement.getAttribute('data-theme');
            if (currentMode === "dark") {
                document.documentElement.setAttribute('data-theme', 'light');
                window.localStorage.setItem('theme', 'light');
                document.getElementById("theme-toggle").innerHTML = '<i class="fa-solid fa-moon"></i>';
            } else {
                document.documentElement.setAttribute('data-theme', 'dark');
                window.localStorage.setItem('theme', 'dark');
                document.getElementById("theme-toggle").innerHTML = '<i class="fa-solid fa-sun"></i>';
            }
        }
    </script>
    
</body>

</html>